<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  
  <title>控制你的充电器</title>
  
</head>
<body>
  
  <div id="app">
    <el-row type="flex" class="row-bg" justify="center">
      <el-col :span="4">
        <div class="grid-content ">
        </div>
      </el-col>
      <el-col :span="16">
        <div class="grid-content ">
          <h1>
            控制你的充电器
          </h1>
          <el-divider></el-divider>
          <el-row>
            <el-col :span="12"><div class="grid-content ">
              <h4>
                手动操作按钮
              </h4>
            </div></el-col>
            <el-col :span="6"><div class="grid-content ">
              <el-button type="danger" onclick="power_on()">接通</el-button>
            </div></el-col>
            <el-col :span="6"><div class="grid-content ">
              <el-button type="success" onclick="power_off()">断开</el-button>
            </div></el-col>
          </el-row>
          <el-divider></el-divider>
          <el-row>
            <el-col :span="12"><div class="grid-content ">
              <h4>
                基于电量自动控制接通
              </h4>
            </div></el-col>
            <el-col :span="12"><div class="grid-content ">
                <el-slider
                  :range = true
                  :step = 5
                  :marks = "power_line_marks"
                  v-model = "power_setting_value"
                  >
                </el-slider>
            </div></el-col>
          </el-row>
        </div>
      </el-col>
      <el-col :span="4">
        <div class="grid-content ">
        </div>
      </el-col>
    </el-row>
    
  </div>
  <script>
    let batteryManager = null;
    let app = new Vue({
      el: '#app',
      data: { 
          power_line_marks: {
            25:'25%',
            50:'50%',
            80:'80%',
          },
          power_setting_value:[25, 80]
      }
    });

    function power_on()
    {
      fetch("power_on");
    }
    function power_off()
    {
      fetch("power_off");
    }

    async function get_battery()
    {
      if(!batteryManager)
      {
        batteryManager = await navigator.getBattery();
      }
      // return batteryManager.level * 100
      return 10;
    }

    async function can_charging()
    {
      let battery_level = await get_battery();
      return app.power_setting_value[0] <= battery_level && battery_level <= app.power_setting_value[1]
    }

    setInterval(async () =>
    {
      console.log(await can_charging());
    },1000)
  </script>
</body>
</html>