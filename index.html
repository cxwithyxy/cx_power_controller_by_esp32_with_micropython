<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  
  <title>控制你的充电器</title>
  
</head>
<body>
  
  <div id="app">
    <el-row type="flex" class="row-bg" justify="center">
      <el-col :span="16">
        <el-row type="flex" align="middle">
          <el-col :span="12">
            <h1>
              控制你的充电器
            </h1>
          </el-col>
          <el-col :span="4">
            <el-row  type="flex" align="middle">
              <el-col :span="12">
                <svg t="1561110112282" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3616" width="40" height="40"><path d="M938.666667 426.666667l0-85.333333c0-46.933333-38.4-85.333333-85.333333-85.333333L128 256c-46.933333 0-85.333333 38.4-85.333333 85.333333l0 341.333333c0 46.933333 38.4 85.333333 85.333333 85.333333l725.333333 0c46.933333 0 85.333333-38.4 85.333333-85.333333l0-85.333333c23.466667 0 42.666667-19.2 42.666667-42.666667l0-85.333333C981.333333 445.866667 962.133333 426.666667 938.666667 426.666667zM896 469.333333l0 85.333333 0 128c0 23.466667-19.2 42.666667-42.666667 42.666667L128 725.333333c-23.466667 0-42.666667-19.2-42.666667-42.666667L85.333333 341.333333c0-23.466667 19.2-42.666667 42.666667-42.666667l725.333333 0c23.466667 0 42.666667 19.2 42.666667 42.666667L896 469.333333zM128 682.666667l554.666667 0L682.666667 341.333333 128 341.333333 128 682.666667z" p-id="3617"></path></svg>

              </el-col>
              <el-col :span="12">
                {{ battery_level }}%
              </el-col>
            </el-row>
          </el-col>
        </el-row>
        <el-divider></el-divider>
        <el-row>
          <el-col :span="12">
            <h4>
              手动操作按钮
            </h4>
          </el-col>
          <el-col :span="6">
            <el-button type="danger" onclick="power_on()">接通</el-button>
          </el-col>
          <el-col :span="6">
            <el-button type="success" onclick="power_off()">断开</el-button>
          </el-col>
        </el-row>
        <el-divider></el-divider>
        <el-row>
          <el-col :span="12">
            <h4>
              基于电量自动控制接通
            </h4>
          </el-col>
          <el-col :span="12">
              <el-slider
                :range = true
                :step = 5
                :marks = "power_line_marks"
                v-model = "power_setting_value"
                >
              </el-slider>
          </el-col>
        </el-row>
      </el-col>
    </el-row>
    
  </div>
  <script>
    let batteryManager = null;
    let app = new Vue({
      el: '#app',
      data: { 
          power_line_marks: {
            25:'25%',
            50:'50%',
            80:'80%',
          },
          power_setting_value:[25, 80],
          battery_level: 0
      },
    });

    function power_on()
    {
      fetch("power_on");
      console.log("power_on");
    }
    function power_off()
    {
      fetch("power_off");
      console.log("power_off");
    }

    async function get_battery()
    {
      if(!batteryManager)
      {
        batteryManager = await navigator.getBattery();
      }
      // return batteryManager.level * 100
      app.battery_level = test_b;
      return test_b;
    }

    async function can_charging()
    {
      let battery_level = await get_battery();
      return app.power_setting_value[0] <= battery_level && battery_level <= app.power_setting_value[1]
    }

    setInterval(async () =>
    {
      let battery_level = await get_battery();
      if(battery_level < app.power_setting_value[0])
      {
        power_on()
      }
      if(battery_level > app.power_setting_value[1])
      {
        power_off()
      }
    },5000)

    let test_b = 10;

    setInterval(() => {
      test_b++
    }, 2000)
  </script>
</body>
</html>